# Expungement Project CLI

The CLI available through the entrypoint script `main.py` allows for running: 
- [Expungement Classification](#expungement-classification)
- [VA Court Data Ingestion Pipeline](#va-court-data-ingestion-pipeline)

## Getting Started

To interact with the CLI, open up a terminal and navigate to your local copy of the LAJC-expungement repo. 

Assuming it is in your home directory: 

```bash
$ cd ~/LAJC-expungement
```

We recommend you create a Python virtual environment for running the CLI, as it has a lot of Python package dependencies. Create one (in the folder `.venv/`) with:

```bash
$ python -m venv .venv
```

Then activate it:

```bash
$ source .venv/bin/activate
```

Then install the necessary dependencies for the CLI:

```bash
$ pip install -r requirements.txt
```

Then you should be able to run `main.py` and see the help menu: 

```bash
$ python main.py --help
Usage: main.py [OPTIONS] COMMAND [ARGS]...

  CLI for working with expungement classification pipelines

Options:
  --help  Show this message and exit.

Commands:
  build-db  Build all tables for expungement classification data model
  classify  Run expungement classification pipeline
  ingest    Run ingestion pipeline to clean and load Virginia court data...
```

See options for any command by running python main.py COMMAND --help. Try:

```bash
python main.py classify --help
```

# Expungement Classification

Run the expungement classification pipeline to determine whether criminal records are eligible for any level of expungement. 

Run the pipeline with default configurations using:

```bash
python main.py classify
```

## Configuration Files

Expungement classification is configurable via YAML config files that change rules about expungement eligibility. These rules represent (some of) the laws that govern expungement eligibility in Virginia. 

Configuration files should be placed in `LAJC-expungement/expunge/configs/`. To create a new config file, start by copying the default configuration file at `LAJC-expungement/expunge/configs/default.yaml`. This file contains explanations as to what each of the configuration fields represent. 

You can pass a configuration file to the pipeline using the `--config-path` option: 

```bash
python main.py classify --config-path "expunge/configs/my-config-file.yaml"
```

Other CLI options:

`--write-features`: Pass this flag if you would like to see the features generated by the pipeline. Features will be written to the `features` table. 

`--n-partitions`: The number of partitions for Dask to use for the VA court charges data. Currently, the ideal configuration for a full run is `--n-partitions 32`.  

# VA Court Data Ingestion Pipeline
